<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fantasy Politics — Votes</title>
<style>
  :root{
    --nav-h:68px;--content-max:1320px;--gutter:20px;--gap:16px;--radius:14px;
    --panel:#171a2b;--panel-2:#1d2140;--text:#e7e9f4;--muted:#9aa1bd;
    --accent:#6ea8fe;--border:1px solid rgba(255,255,255,.06);--shadow:0 8px 24px rgba(0,0,0,.25);
    --ok:#27c281;--bad:#d34a4a;
  }
  *,*:before,*:after{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;color:var(--text);background:linear-gradient(180deg,#0b0e1a,#0f1220);font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:var(--content-max);margin:0 auto;padding:16px var(--gutter) 60px}

  /* Top bar */
  .nav{height:var(--nav-h);display:flex;align-items:center;justify-content:space-between;padding:0 var(--gutter);border-bottom:var(--border);background:#0e1222;position:sticky;top:0;z-index:10}
  .brand{font-weight:700;letter-spacing:.2px}
  .brand b{color:var(--accent)}
  .seg{display:flex;gap:8px;background:rgba(255,255,255,.04);padding:6px;border-radius:999px;border:var(--border)}
  .seg .btn{padding:8px 14px;border-radius:999px;cursor:pointer;opacity:.9}
  .seg .btn:hover{opacity:1;background:rgba(255,255,255,.05)}
  .seg .on{background:var(--accent);color:#0b0e1a}

  /* Controls */
  .controls{display:grid;grid-template-columns:1fr 200px 200px 200px;gap:var(--gap);padding:16px;background:var(--panel);border:var(--border);border-radius:var(--radius);box-shadow:var(--shadow);margin-top:16px}
  .input,.select{height:38px;background:var(--panel-2);border:var(--border);border-radius:10px;color:var(--text);padding:0 12px;outline:none}
  .input::placeholder{color:var(--muted)}

  /* List */
  .section-title{margin:18px 6px 8px;color:var(--muted);font-size:.95rem}
  .votes{display:flex;flex-direction:column;gap:12px}
  .vote{background:var(--panel);border:var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
  .vote header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 16px 8px}
  .bill{font-weight:600}
  .meta{color:var(--muted);font-size:.9rem}
  .badges{display:flex;gap:8px;align-items:center}
  .badge{font-size:.82rem;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:var(--border)}
  .pass{background:rgba(39,194,129,.14);color:#78e2ba}
  .fail{background:rgba(211,74,74,.14);color:#f09b9b}
  .details{padding:0 16px 14px;color:var(--muted)}
  .tools{display:flex;gap:8px}
  .tool{cursor:pointer;padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.05);border:var(--border);font-size:.82rem}
  .tool:hover{background:rgba(255,255,255,.08)}
  .hide{display:none}
  .pin{outline:2px solid rgba(110,168,254,.45)}
</style>
</head>
<body>

<!-- Top navigation -->
<div class="nav">
  <div class="brand">Fantasy <b>Politics</b></div>
  <div class="seg" id="view">
    <a class="btn" href="index.html">Scoreboard</a>
    <a class="btn" href="cards.html">Cards</a>
    <a class="btn on" href="votes.html">Votes</a>
    <a class="btn" href="#">Draft</a>
    <a class="btn" href="#">Rules</a>
  </div>
</div>

<div class="wrap">
  <!-- Controls -->
  <div class="controls">
    <input id="q" class="input" placeholder="Search bill title, number…"/>
    <select id="ch" class="select">
      <option value="">All Chambers</option>
      <option>House</option>
      <option>Senate</option>
    </select>
    <select id="res" class="select">
      <option value="">All Results</option>
      <option value="pass">Passed</option>
      <option value="fail">Failed</option>
    </select>
    <select id="sort" class="select">
      <option value="new">Sort: Newest</option>
      <option value="old">Sort: Oldest</option>
    </select>
  </div>

  <div class="section-title">Selected:</div>
  <div id="selected" class="badges" style="margin:0 6px 16px;"></div>

  <div id="list" class="votes"></div>
</div>

<script>
const $ = sel => document.querySelector(sel);
const list = $('#list'), q = $('#q'), ch = $('#ch'), res = $('#res'), sortSel = $('#sort'), selected = $('#selected');

function renderVote(v){
  const id = v.id || (v.bill_number || v.bill || 'bill').toLowerCase().replace(/\s+/g,'-');
  const passed = v.result?.toLowerCase() === 'passed';
  const el = document.createElement('article');
  el.className = 'vote';
  el.id = 'vote-' + id;

  const yeas = v.yes ?? v.yeas ?? 0;
  const nays = v.no ?? v.nays ?? 0;
  const chamber = (v.chamber || '').replace(/^[a-z]/, m=>m.toUpperCase());
  const date = v.date ? new Date(v.date) : null;
  const dateTxt = date ? date.toLocaleDateString(undefined, {month:'short', day:'numeric', year:'numeric'}) : '';

  el.innerHTML = `
    <header>
      <div>
        <div class="bill">${v.bill_number || v.title || 'Bill'}</div>
        <div class="meta">${chamber}${dateTxt ? ' · ' + dateTxt : ''}</div>
      </div>
      <div class="badges">
        <span class="badge ${passed?'pass':'fail'}">${passed?'Passed':'Failed'}</span>
        <span class="badge">Yeas ${yeas}</span>
        <span class="badge">Nays ${nays}</span>
        <div class="tools">
          <button class="tool" data-copy="#${el.id}">Copy link</button>
          <button class="tool" data-toggle>Details</button>
        </div>
      </div>
    </header>
    <div class="details hide">${v.summary || 'No summary available.'}</div>
  `;
  el.addEventListener('click', e=>{
    if(e.target.matches('[data-toggle]')){
      el.querySelector('.details').classList.toggle('hide');
    }else if(e.target.matches('[data-copy]')){
      const h = location.href.split('#')[0] + '#' + el.id;
      navigator.clipboard?.writeText(h);
      e.target.textContent = 'Copied';
      setTimeout(()=>e.target.textContent='Copy link',900);
    }
  });
  return el;
}

function applyFilters(all){
  const term = q.value.trim().toLowerCase();
  const chamber = ch.value;
  const result = res.value;
  let rows = all.filter(v=>{
    const t = (v.bill_number||v.title||'').toLowerCase();
    if(term && !t.includes(term)) return false;
    if(chamber && (v.chamber||'').toLowerCase() !== chamber.toLowerCase()) return false;
    if(result){
      const passed = (v.result||'').toLowerCase()==='passed';
      if(result==='pass' && !passed) return false;
      if(result==='fail' && passed) return false;
    }
    return true;
  });
  rows.sort((a,b)=>{
    const da = +new Date(a.date||0), db = +new Date(b.date||0);
    return sortSel.value==='old' ? da-db : db-da;
  });
  return rows;
}

function hydrate(all){
  list.innerHTML='';
  applyFilters(all).forEach(v=>list.appendChild(renderVote(v)));
}

function deepLink(){
  if(location.hash.startsWith('#vote-')){
    const target = document.getElementById(location.hash.slice(1));
    if(target){ target.classList.add('pin'); target.querySelector('.details')?.classList.remove('hide'); target.scrollIntoView({behavior:'smooth',block:'start'}); setTimeout(()=>target.classList.remove('pin'),1600); }
  }
}

async function boot(){
  const pills = [];
  if(ch.value) pills.push('Chamber: '+ch.value);
  if(res.value) pills.push('Result: '+(res.value==='pass'?'Passed':'Failed'));
  selected.innerHTML = pills.map(x=>`<span class="badge">${x}</span>`).join('');

  const mock = [
    {id:'hr-1001', bill_number:'H.R. 1001', title:'Infrastructure Investment and Jobs', chamber:'House',  date:'2025-09-24', result:'Passed', yes:321, no:109, summary:'Highways, bridges, broadband.'},
    {id:'s-204',   bill_number:'S. 204',   title:'Climate Resilience Act',           chamber:'Senate', date:'2025-09-22', result:'Failed', yes:48,  no:52,  summary:'Renewables and coastal protection.'},
    {id:'hr-1002', bill_number:'H.R. 1002', title:'Small Business Relief',           chamber:'House',  date:'2025-09-20', result:'Passed', yes:298, no:127, summary:'Tax credits and loans.'},
    {id:'s-310',   bill_number:'S. 310',   title:'Supply Chain Security',            chamber:'Senate', date:'2025-09-18', result:'Passed', yes:74,  no:24,  summary:'Domestic manufacturing incentives.'},
    {id:'hr-1003', bill_number:'H.R. 1003', title:'Rural Healthcare Expansion',      chamber:'House',  date:'2025-09-17', result:'Passed', yes:305, no:119, summary:'Clinics and telemedicine grants.'},
    {id:'s-402',   bill_number:'S. 402',   title:'Fiscal Responsibility Reform',     chamber:'Senate', date:'2025-09-16', result:'Failed', yes:49,  no:51,  summary:'Spending caps and PAYGO.'},
    {id:'hr-1004', bill_number:'H.R. 1004', title:'Veterans Housing Support',        chamber:'House',  date:'2025-09-15', result:'Passed', yes:330, no:94,  summary:'VA vouchers and rehab funds.'},
    {id:'s-255',   bill_number:'S. 255',   title:'Data Privacy Standards',           chamber:'Senate', date:'2025-09-13', result:'Passed', yes:68,  no:30,  summary:'Uniform national privacy rules.'},
    {id:'hr-1005', bill_number:'H.R. 1005', title:'Cybersecurity Modernization',     chamber:'House',  date:'2025-09-12', result:'Passed', yes:289, no:136, summary:'State and local cyber grants.'},
    {id:'s-512',   bill_number:'S. 512',   title:'Public Lands Conservation',        chamber:'Senate', date:'2025-09-10', result:'Failed', yes:47,  no:53,  summary:'Trail and habitat funding.'},
    {id:'hr-1006', bill_number:'H.R. 1006', title:'STEM Education Boost',            chamber:'House',  date:'2025-09-08', result:'Passed', yes:314, no:110, summary:'Scholarships and lab upgrades.'},
    {id:'s-520',   bill_number:'S. 520',   title:'Transportation Safety Rules',      chamber:'Senate', date:'2025-09-06', result:'Passed', yes:72,  no:26,  summary:'Rail inspections and standards.'},
    {id:'hr-1007', bill_number:'H.R. 1007', title:'Affordable Housing Tax Credit',   chamber:'House',  date:'2025-09-05', result:'Failed', yes:218, no:212, summary:'LIHTC expansion.'},
    {id:'s-531',   bill_number:'S. 531',   title:'Semiconductor R&D Grants',         chamber:'Senate', date:'2025-09-03', result:'Passed', yes:76,  no:22,  summary:'Chip research funding.'},
    {id:'hr-1008', bill_number:'H.R. 1008', title:'Opioid Response Enhancement',     chamber:'House',  date:'2025-09-02', result:'Passed', yes:338, no:86,  summary:'Treatment access and naloxone.'},
    {id:'s-545',   bill_number:'S. 545',   title:'Farm Drought Assistance',          chamber:'Senate', date:'2025-08-30', result:'Failed', yes:50,  no:50,  summary:'Emergency water programs.'},
    {id:'hr-1009', bill_number:'H.R. 1009', title:'AI Safety and Transparency',      chamber:'House',  date:'2025-08-28', result:'Passed', yes:284, no:141, summary:'Model reporting and audits.'},
    {id:'s-560',   bill_number:'S. 560',   title:'Student Loan Refinancing',         chamber:'Senate', date:'2025-08-26', result:'Failed', yes:46,  no:54,  summary:'Rate caps and refinance window.'},
    {id:'hr-1010', bill_number:'H.R. 1010', title:'Border Infrastructure Upgrade',   chamber:'House',  date:'2025-08-24', result:'Passed', yes:299, no:126, summary:'Ports of entry modernization.'},
    {id:'s-575',   bill_number:'S. 575',   title:'Disaster Relief Supplemental',     chamber:'Senate', date:'2025-08-22', result:'Passed', yes:70,  no:28,  summary:'Hurricane and wildfire aid.'}
  ];

  hydrate(mock);
  deepLink();
}

['input','change'].forEach(ev=>{
  q.addEventListener(ev, ()=>boot());
  ch.addEventListener(ev, ()=>boot());
  res.addEventListener(ev, ()=>boot());
  sortSel.addEventListener(ev, ()=>boot());
});

document.addEventListener('DOMContentLoaded', boot);
window.addEventListener('hashchange', deepLink);
</script>
</body>
</html>
