<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Capitol League — Scoreboard</title>

<link rel="stylesheet" href="shared.css?v=2">
<script defer src="shared.js?v=2"></script>

<style>
  :root{--nav-h:68px;--content-max:1320px;--gutter:20px;--gap:20px;--radius:14px;
        --panel:#171a2b;--panel-2:#1d2140;--text:#e7e9f4;--muted:#9aa1bd;--accent:#6ea8fe;
        --border:1px solid rgba(255,255,255,.06);--shadow:0 8px 24px rgba(0,0,0,.25);--control-h:36px}
  *,*:before,*:after{box-sizing:border-box}
  body{margin:0;color:var(--text);background:linear-gradient(180deg,#0b0e1a,#0f1220);font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  a{color:inherit;text-decoration:none}

  /* Page content lives inside .cl-content */
  .main{background:var(--panel);border:var(--border);border-radius:var(--radius);box-shadow:var(--shadow);min-width:0;display:grid;grid-template-rows:auto 1fr;min-height:calc(100vh - var(--nav-h) - 2*var(--gutter))}
  .main__toolbar{padding:14px;border-bottom:var(--border);display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  .toolbar-group{display:inline-flex;align-items:center;gap:8px;background:var(--panel-2);border:var(--border);border-radius:10px;padding:6px 8px}
  .label{color:var(--muted);font-size:12px}
  .segmented{display:inline-flex;border-radius:8px;overflow:hidden;border:var(--border)}
  .segmented button{background:transparent;border:0;color:var(--text);padding:0 12px;height:var(--control-h);cursor:pointer}
  .segmented .active{background:#243055}
  .notice{margin:10px 0 0;background:#1a2144;border:var(--border);border-radius:10px;padding:8px 10px;color:var(--muted);font-size:13px}
  .main__scroll{overflow:auto;padding:16px}
  .section{background:#151934;border:var(--border);border-radius:12px;padding:16px;margin-bottom:16px}
  .h1{font-size:22px;font-weight:800;margin:0 0 8px}
  .muted{color:var(--muted)}

  /* Score total */
  .scorebox{height:220px;background:#10152c;border:var(--border);border-radius:12px;display:grid;place-items:center;text-align:center}
  .scorebox .big{font-size:56px;font-weight:900;letter-spacing:.5px}

  /* Votes accordion */
  .votes{display:flex;flex-direction:column;gap:10px}
  .vote{background:#111634;border:var(--border);border-radius:12px;overflow:hidden}
  .vote header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px 14px;cursor:pointer}
  .vote header:hover{background:#141a3a}
  .bill{font-weight:600}
  .meta{color:var(--muted);font-size:.9rem}
  .badges{display:flex;gap:8px;align-items:center}
  .badge{font-size:.78rem;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,.06);border:var(--border)}
  .pass{background:rgba(39,194,129,.14);color:#78e2ba}.fail{background:rgba(211,74,74,.14);color:#f09b9b}
  .body{display:none}
  .open .body{display:grid;grid-template-columns:1.6fr 1fr;gap:14px;padding:0 14px 14px}
  .panel{background:#121631;border:var(--border);border-radius:12px;padding:12px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .kv{background:#0f142b;border:var(--border);border-radius:10px;padding:8px}
  .kv b{display:block;font-size:.75rem;color:var(--muted);margin-bottom:4px}
  .kv span{font-weight:600}
  .party-legend{display:flex;gap:12px;font-size:.78rem;color:var(--muted);margin:6px 0}
  .party-legend i{display:inline-block;width:10px;height:10px;border-radius:999px;margin-right:6px}
  .bar{height:8px;border-radius:999px;background:#0f142b;overflow:hidden;border:var(--border);position:relative}
  .bar i{display:block;height:100%;position:absolute;left:0;top:0}
  .bar .r{background:#b24a4a}.bar .d{background:#4a77d3}.bar .i{background:#d3b84a}
  .statrow{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:10px}
  .btns{display:flex;flex-wrap:wrap;gap:8px}
  .tool{cursor:pointer;padding:6px 10px;border-radius:8px;background:#0f142b;border:var(--border);font-size:.8rem}
  .tool:hover{background:rgba(255,255,255,.08)}
  @media (max-width:980px){.open .body{grid-template-columns:1fr}}
</style>
</head>

<body data-page="scoreboard">
  <!-- shared nav mounts here -->
  <div id="app-nav"></div>

  <!-- shared shell -->
  <div class="cl-shell">
    <aside id="my-team"></aside>
    <main class="cl-content">
      <div class="main" id="main">
        <div class="main__toolbar">
          <!-- remove duplicate page navigation to avoid two navs -->
          <div class="toolbar-group">
            <span class="label">Scope</span>
            <div class="segmented" id="scopeTabs" role="tablist" aria-label="Scope">
              <button data-scope="week" class="active" aria-selected="true" role="tab">Week</button>
              <button data-scope="season" role="tab">Season</button>
              <button data-scope="career" role="tab">Career</button>
            </div>
          </div>
          <div class="toolbar-group">
            <span class="label">Filters</span>
            <button class="tool" id="partyBtn">Party</button>
            <button class="tool" id="stateBtn">State</button>
            <button class="tool" id="badgesBtn">Badges</button>
          </div>
          <div class="notice">Votes here mirror Week/Season. Career hides the list.</div>
        </div>

        <div class="main__scroll" tabindex="0">
          <section class="section">
            <h2 class="h1">Scoreboard</h2>
            <div class="scorebox">
              <div>
                <div class="big" id="scoreTotal">0</div>
                <div class="muted" id="scoreCaption">Total points · Week</div>
              </div>
            </div>
          </section>

          <section class="section" id="votesSection">
            <h3 class="h1">Votes (Preview)</h3>
            <div class="votes" id="votesList"></div>
          </section>
        </div>
      </div>
    </main>
  </div>

<script>
/* Sample data */
const SAMPLE_TEAM = [
  {id:"A1",name:"Alex Brewer",party:"D",state:"WI",initials:"AB",scores:{week:128,season:412,career:2011}},
  {id:"B2",name:"Casey Stone",party:"R",state:"TX",initials:"CS",scores:{week:96,season:305,career:1540}},
  {id:"C3",name:"Jordan Moss",party:"I",state:"VT",initials:"JM",scores:{week:77,season:221,career:1204}},
  {id:"D4",name:"Lena Kay",party:"D",state:"CA",initials:"LK",scores:{week:71,season:190,career:1002}},
  {id:"E5",name:"Ray Boone",party:"R",state:"OH",initials:"RB",scores:{week:64,season:178,career:954}}
];
const SAMPLE_VOTES = {
  week:[
    {id:'s-575', roll:'575', bill_number:'S. 575', title:'Disaster Relief Supplemental', chamber:'Senate', date:'2025-08-22', result:'Passed', yes:70, no:28, summary:'Hurricane and wildfire aid.'},
    {id:'hr-1010', bill_number:'H.R. 1010', title:'Border Infrastructure Upgrade', chamber:'House', date:'2025-08-24', result:'Passed', yes:299, no:126, summary:'Ports of entry modernization.'},
    {id:'s-560', bill_number:'S. 560', title:'Student Loan Refinancing', chamber:'Senate', date:'2025-08-26', result:'Failed', yes:46, no:54, summary:'Rate caps and refinance window.'}
  ],
  season:[]
};

let SCOPE = "week";
const $ = s=>document.querySelector(s);

document.addEventListener("DOMContentLoaded", () => {
  bindUI();
  setScope(SCOPE);
});

function bindUI(){
  const tabs = $('#scopeTabs');
  if(tabs){
    tabs.addEventListener('click', e=>{
      const btn = e.target.closest('button[data-scope]'); if(!btn) return;
      SCOPE = btn.dataset.scope;
      Array.from(tabs.querySelectorAll('button')).forEach(b=>b.classList.toggle('active', b===btn));
      btn.setAttribute('aria-selected','true');
      setScope(SCOPE);
    });
  }
  $('#partyBtn')?.addEventListener('click', ()=>alert('Party filter coming soon'));
  $('#stateBtn')?.addEventListener('click', ()=>alert('State filter coming soon'));
  $('#badgesBtn')?.addEventListener('click', ()=>alert('Badges filter coming soon'));
}

function setScope(scope){
  const total = SAMPLE_TEAM.reduce((s,m)=>s+(m.scores?.[scope]??0),0);
  $('#scoreTotal').textContent = new Intl.NumberFormat().format(total);
  $('#scoreCaption').textContent = `Total points · ${cap(scope)}`;
  $('#votesSection').style.display = scope==="career" ? "none" : "block";
  renderVotes(scope);
}

function renderVotes(scope){
  const list = $('#votesList'); list.innerHTML='';
  const rows = (SAMPLE_VOTES?.[scope]||[]);
  if(!rows.length){ list.innerHTML = '<div class="muted">No votes available.</div>'; return; }
  rows.forEach(v=> list.appendChild(voteCard(v)));
}

function voteCard(v){
  const id = v.id || (v.bill_number||v.title||'bill').toLowerCase().replace(/\s+/g,'-');
  const passed = (v.result||'').toLowerCase()==='passed';
  const yeas = v.yes ?? v.yeas ?? 0, nays = v.no ?? v.nays ?? 0;
  const dateTxt = v.date ? new Date(v.date).toLocaleDateString(undefined,{month:'short',day:'numeric',year:'numeric'}) : '';
  const chamber = (v.chamber||'').replace(/^[a-z]/,m=>m.toUpperCase());

  const el = document.createElement('article');
  el.className='vote'; el.id='vote-'+id;
  el.innerHTML = `
    <header>
      <div>
        <div class="bill">${esc(v.bill_number||v.title||'Bill')} — ${esc(v.title||'')}</div>
        <div class="meta">${esc(chamber)}${dateTxt?' · '+dateTxt:''}</div>
      </div>
      <div class="badges">
        <span class="badge ${passed?'pass':'fail'}">${passed?'Passed':'Failed'}</span>
        <span class="badge">Yeas ${yeas}</span>
        <span class="badge">Nays ${nays}</span>
      </div>
    </header>
    <div class="body">
      <div class="panel">
        <div style="margin-bottom:8px;color:var(--muted)">${esc(v.summary||'')}</div>
        <div class="grid">
          <div class="kv"><b>Bill Number</b><span>${esc(v.bill_number||'-')}</span></div>
          <div class="kv"><b>Result</b><span>${passed?'Passed':'Failed'} (${yeas}–${nays})</span></div>
          <div class="kv"><b>Chamber</b><span>${esc(chamber||'-')}</span></div>
          <div class="kv"><b>Date</b><span>${dateTxt||'-')}</span></div>
        </div>
        <div class="party-legend">
          <span><i style="background:#b24a4a"></i>R</span>
          <span><i style="background:#4a77d3"></i>D</span>
          <span><i style="background:#d3b84a"></i>I</span>
        </div>
        <div class="bar" aria-label="Party distribution">
          <i class="r" style="width:34%"></i>
          <i class="d" style="width:58%;left:34%"></i>
          <i class="i" style="width:8%;left:92%"></i>
        </div>
        <div class="statrow">
          <div class="kv"><b>R</b><span>Yeas 110 · Nays 120</span></div>
          <div class="kv"><b>D</b><span>Yeas 170 · Nays 25</span></div>
          <div class="kv"><b>I</b><span>Yeas 7 · Nays 0</span></div>
        </div>
      </div>
      <aside class="panel">
        <div class="btns">
          <button class="tool" data-copy>Copy link</button>
          <button class="tool" onclick="location.href='votes.html'">Open in Votes</button>
        </div>
      </aside>
    </div>
  `;
  el.querySelector('header').addEventListener('click', ()=>{
    document.querySelectorAll('.vote.open').forEach(n=>{ if(n!==el) n.classList.remove('open'); });
    el.classList.toggle('open');
  });
  el.addEventListener('click', e=>{
    if(e.target.matches('[data-copy]')){
      const h = location.href.split('#')[0] + '#' + el.id;
      navigator.clipboard?.writeText(h);
      e.target.textContent='Copied'; setTimeout(()=>e.target.textContent='Copy link',900);
    }
  });
  return el;
}

function esc(s){return String(s??'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}
function cap(s){return s.charAt(0).toUpperCase()+s.slice(1);}
</script>
</body>
</html>
